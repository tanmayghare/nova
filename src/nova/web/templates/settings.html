{% extends "base.html" %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <h1 class="text-2xl font-bold mb-8">Settings</h1>
    
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Settings navigation -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-lg font-semibold mb-4">Settings Categories</h2>
            <nav>
                <ul class="space-y-2">
                    <li>
                        <a href="#general" class="block px-3 py-2 rounded hover:bg-gray-50 text-gray-700">
                            General
                        </a>
                    </li>
                    <li>
                        <a href="#browser" class="block px-3 py-2 rounded hover:bg-gray-50 text-gray-700">
                            Browser
                        </a>
                    </li>
                    <li>
                        <a href="#models" class="block px-3 py-2 rounded hover:bg-gray-50 text-gray-700">
                            LLM Models
                        </a>
                    </li>
                    <li>
                        <a href="#tools" class="block px-3 py-2 rounded hover:bg-gray-50 text-gray-700">
                            Tools
                        </a>
                    </li>
                    <li>
                        <a href="#advanced" class="block px-3 py-2 rounded hover:bg-gray-50 text-gray-700">
                            Advanced
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
        
        <!-- Settings forms -->
        <div class="lg:col-span-2">
            <!-- General Settings -->
            <div id="general" class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h2 class="text-lg font-semibold mb-4">General Settings</h2>
                <form id="general-form" class="space-y-4">
                    <div>
                        <label for="user_name" class="block text-sm font-medium text-gray-700 mb-1">User Name</label>
                        <input type="text" id="user_name" name="user_name" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" value="Default User">
                    </div>
                    
                    <div>
                        <label for="log_level" class="block text-sm font-medium text-gray-700 mb-1">Log Level</label>
                        <select id="log_level" name="log_level" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="error">Error</option>
                            <option value="warning">Warning</option>
                            <option value="info" selected>Info</option>
                            <option value="debug">Debug</option>
                        </select>
                    </div>
                    
                    <div class="flex items-center">
                        <input type="checkbox" id="auto_update" name="auto_update" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded" checked>
                        <label for="auto_update" class="ml-2 block text-sm text-gray-700">Enable automatic updates</label>
                    </div>
                    
                    <div>
                        <label for="data_directory" class="block text-sm font-medium text-gray-700 mb-1">Data Directory</label>
                        <input type="text" id="data_directory" name="data_directory" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" value="~/.nova/data">
                    </div>
                    
                    <div class="pt-4">
                        <button type="submit" class="bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                            Save General Settings
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Browser Settings -->
            <div id="browser" class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h2 class="text-lg font-semibold mb-4">Browser Settings</h2>
                <form id="browser-form" class="space-y-4">
                    <div>
                        <label for="browser_type" class="block text-sm font-medium text-gray-700 mb-1">Browser Type</label>
                        <select id="browser_type" name="browser_type" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="chromium" selected>Chromium</option>
                            <option value="firefox">Firefox</option>
                            <option value="webkit">WebKit</option>
                        </select>
                    </div>
                    
                    <div class="flex items-center">
                        <input type="checkbox" id="headless" name="headless" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                        <label for="headless" class="ml-2 block text-sm text-gray-700">Run browser in headless mode by default</label>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="viewport_width" class="block text-sm font-medium text-gray-700 mb-1">Viewport Width</label>
                            <input type="number" id="viewport_width" name="viewport_width" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" value="1280">
                        </div>
                        <div>
                            <label for="viewport_height" class="block text-sm font-medium text-gray-700 mb-1">Viewport Height</label>
                            <input type="number" id="viewport_height" name="viewport_height" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" value="800">
                        </div>
                    </div>
                    
                    <div>
                        <label for="user_agent" class="block text-sm font-medium text-gray-700 mb-1">User Agent (optional)</label>
                        <input type="text" id="user_agent" name="user_agent" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Custom user agent string">
                    </div>
                    
                    <div class="pt-4">
                        <button type="submit" class="bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                            Save Browser Settings
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Models Settings -->
            <div id="models" class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h2 class="text-lg font-semibold mb-4">LLM Model Settings</h2>
                <form id="models-form" class="space-y-4">
                    <div>
                        <label for="default_model" class="block text-sm font-medium text-gray-700 mb-1">Default Model</label>
                        <select id="default_model" name="default_model" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="llama-3.3-nemotron-super-49b-v1" selected>NVIDIA NIM (llama-3.3-nemotron-super-49b-v1)</option>
                            <option value="mistral-small3.1:24b-instruct-2503-q4_K_M">Mistral Small 3.1 24B</option>
                            <option value="llama3.2-vision:11b-instruct-fp16">Llama 3.2 Vision 11B</option>
                            <option value="llama3.2-vision:11b-instruct-q4_K_M">Llama 3.2 Vision 11B (Quantized)</option>
                        </select>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="context_length" class="block text-sm font-medium text-gray-700 mb-1">Context Length</label>
                            <input type="number" id="context_length" name="context_length" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" value="4096">
                        </div>
                        <div>
                            <label for="temperature" class="block text-sm font-medium text-gray-700 mb-1">Temperature</label>
                            <input type="number" id="temperature" name="temperature" step="0.1" min="0" max="2" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" value="0.7">
                        </div>
                    </div>
                    
                    <div>
                        <label for="system_prompt" class="block text-sm font-medium text-gray-700 mb-1">Default System Prompt</label>
                        <textarea id="system_prompt" name="system_prompt" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">You are Nova, an intelligent browser automation agent. You help users navigate the web and perform tasks.</textarea>
                    </div>
                    
                    <div class="pt-4">
                        <button type="submit" class="bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                            Save Model Settings
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Get navigation links and forms
        const settingsNavLinks = document.querySelectorAll('.bg-white nav a');  // Only select settings sidebar links
        const forms = document.querySelectorAll('form');
        
        // Add click event listeners to settings navigation links
        settingsNavLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                
                // Get the target section
                const targetId = link.getAttribute('href').substring(1);
                const targetSection = document.getElementById(targetId);
                
                // Scroll to the target section
                if (targetSection) {
                    targetSection.scrollIntoView({ behavior: 'smooth' });
                }
                
                // Update active link
                settingsNavLinks.forEach(l => {
                    l.classList.remove('bg-indigo-50', 'text-indigo-700', 'font-medium');
                    l.classList.add('hover:bg-gray-50', 'text-gray-700');
                });
                link.classList.remove('hover:bg-gray-50', 'text-gray-700');
                link.classList.add('bg-indigo-50', 'text-indigo-700', 'font-medium');
            });
        });
        
        // Form submission
        forms.forEach(form => {
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                
                // In a real application, this would send data to the server
                // For demo purposes, just show a success message
                const formId = form.id;
                let settingsType = '';
                
                switch (formId) {
                    case 'general-form':
                        settingsType = 'General';
                        break;
                    case 'browser-form':
                        settingsType = 'Browser';
                        break;
                    case 'models-form':
                        settingsType = 'LLM Model';
                        break;
                    default:
                        settingsType = '';
                }
                
                alert(`${settingsType} settings saved successfully!`);
            });
        });
        
        // Highlight the section that's most visible in the viewport
        function updateActiveSection() {
            const sections = document.querySelectorAll('[id^="general"], [id^="browser"], [id^="models"], [id^="tools"], [id^="advanced"]');
            let mostVisible = null;
            let maxVisibleHeight = 0;
            
            sections.forEach(section => {
                const rect = section.getBoundingClientRect();
                const visibleHeight = Math.min(rect.bottom, window.innerHeight) - Math.max(rect.top, 0);
                
                if (visibleHeight > maxVisibleHeight) {
                    maxVisibleHeight = visibleHeight;
                    mostVisible = section;
                }
            });
            
            if (mostVisible) {
                const sectionId = mostVisible.id;
                const activeLink = document.querySelector(`nav a[href="#${sectionId}"]`);
                
                if (activeLink) {
                    settingsNavLinks.forEach(l => {
                        l.classList.remove('bg-indigo-50', 'text-indigo-700', 'font-medium');
                        l.classList.add('hover:bg-gray-50', 'text-gray-700');
                    });
                    activeLink.classList.remove('hover:bg-gray-50', 'text-gray-700');
                    activeLink.classList.add('bg-indigo-50', 'text-indigo-700', 'font-medium');
                }
            }
        }
        
        // Update active section on scroll
        window.addEventListener('scroll', updateActiveSection);
        
        // Initial update
        updateActiveSection();
    });
</script>
{% endblock %} 